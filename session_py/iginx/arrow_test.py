from iginx.iginx_pyclient.session import Session
from iginx.iginx_pyclient.thrift.rpc.ttypes import DataType, AggregateType

if __name__ == '__main__':
    session = Session('127.0.0.1', 6888, "root", "root")
    session.open()

    # 获取集群拓扑信息
    cluster_info = session.get_cluster_info()
    print(cluster_info)

    # 写入数据
    paths = ["a.a.a", "a.a.b", "a.b.b", "a.c.c"]
    timestamps = [1, 2, 3, 4]
    values_list = [
        ['1', 'b', None, None],
        [None, None, 'b', None],
        [None, None, None, 'c'],
        ['2', 'W', 'E', 'R'],
    ]
    data_type_list = [DataType.BINARY, DataType.BINARY, DataType.BINARY, DataType.BINARY]
    # session.insert_row_records(paths, timestamps, values_list, data_type_list)

    # 查询写入的数据
    import time, torch, pandas as pd
    first=[]
    second=[]
    third=[]
    for _ in range(10):
        result, first_time = session.queryArrow(["lineitem.*"], 0, 10000)
        # result = session.get_batch_from_arrow(dataset.queryArrowData)
        # print(result)
        # 转换为pandas.Dataframe
        mid_time = time.perf_counter()
        df = result.to_pandas()
        mid2_time = time.perf_counter()
        # tensors = [torch.tensor(col.to_numpy()) for col in result.columns]
        columns = {name: col.to_numpy() for name, col in zip(result.column_names, result.columns)}
        df = pd.DataFrame(columns)

        end_time = time.perf_counter()
        print(df)
        print(f"mid-start:{first_time}")
        print(f"mid2:{mid2_time-mid_time}")
        print(f"end-mid:{end_time-mid2_time}")
        first.append(first_time)
        second.append(mid2_time-mid_time)
        third.append(end_time - mid2_time)

    print(first)
    print(second)
    print(third)


    session.close()


# lineitem 600572 * 17
"""
mid-start:2.0668468000003486
end-mid:0.8727023000028566
mid-start:1.761918299998797
end-mid:0.8323769999988144
mid-start:2.08687849999842
end-mid:0.7691163000054075
mid-start:1.6752682000005734
end-mid:0.8996875000011642
mid-start:1.7218551999976626
end-mid:0.7626037000009092
mid-start:1.6452897999988636
end-mid:0.875633800002106
mid-start:1.664471100004448
end-mid:0.7830721999998786
mid-start:1.6261924999998882
end-mid:0.8803833999991184
mid-start:1.7682529000012437
end-mid:0.8372417999999016
mid-start:1.727894199997536
end-mid:0.8147263999999268
[2.0668468000003486, 1.761918299998797, 2.08687849999842, 1.6752682000005734, 1.7218551999976626, 1.6452897999988636, 1.664471100004448, 1.6261924999998882, 1.7682529000012437, 1.727894199997536]
[0.8727023000028566, 0.8323769999988144, 0.7691163000054075, 0.8996875000011642, 0.7626037000009092, 0.875633800002106, 0.7830721999998786, 0.8803833999991184, 0.8372417999999016, 0.8147263999999268]
"""


"""11111111111111111
[1.9180740999872796, 1.7955502999975579, 1.6856551999953808, 1.6654470000066794, 1.8386234000063268, 1.8214746000012383, 1.716595599995344, 1.6238332000066293, 1.723740599991288, 1.8864934000012]
[0.8172996000066632, 0.8465260999946622, 0.7585822999972152, 0.7030959999974584, 0.7934389000001829, 0.7884607000014512, 0.8217178999911994, 0.7366063999943435, 0.767894200005685, 0.7127824999915902]
[0.738414899999043, 0.7269541999994544, 0.6923833000037121, 0.7167010999983177, 0.6687718000030145, 0.7218078000005335, 0.66796270001214, 0.6824702000012621, 0.6958613000024343, 0.662643300005584]
"""


"""2222
mid-start:2.2430510000049253
end-mid:0.01695569999719737
mid-start:2.326983200000541
end-mid:0.008969200003775768
mid-start:2.8551394999958575
end-mid:0.0076648000031127594
mid-start:2.2111874999973224
end-mid:0.00841490000311751
mid-start:2.8954866000058246
end-mid:0.008612699995865114
mid-start:2.8209933000034653
end-mid:0.008751599998504389
mid-start:2.5846934000001056
end-mid:0.008244099997682497
mid-start:2.773447200001101
end-mid:0.008108499998343177
mid-start:2.451384300002246
end-mid:0.00617489999422105
mid-start:2.624486499997147
end-mid:0.006805600001825951
[2.2430510000049253, 2.326983200000541, 2.8551394999958575, 2.2111874999973224, 2.8954866000058246, 2.8209933000034653, 2.5846934000001056, 2.773447200001101, 2.451384300002246, 2.624486499997147]
[0.01695569999719737, 0.008969200003775768, 0.0076648000031127594, 0.00841490000311751, 0.008612699995865114, 0.008751599998504389, 0.008244099997682497, 0.008108499998343177, 0.00617489999422105, 0.006805600001825951]
"""



"""3
mid-start:1.7417412000067998
end-mid:0.8770668999932241
mid-start:1.7021237000008114
end-mid:0.6188776999988477
mid-start:1.6640793000042322
end-mid:0.761751699996239
mid-start:1.6986077999972622
end-mid:0.8418739999979152
mid-start:1.8615247000052477
end-mid:0.8385743999970146
mid-start:1.720088800000667
end-mid:0.80280219999986
mid-start:1.6633631000004243
end-mid:0.7346493000004557
mid-start:1.705866899996181
end-mid:0.8035249000022304
mid-start:1.672046899999259
end-mid:0.7730817999981809
mid-start:1.706885699997656
end-mid:0.926364899998589
[1.7417412000067998, 1.7021237000008114, 1.6640793000042322, 1.6986077999972622, 1.8615247000052477, 1.720088800000667, 1.6633631000004243, 1.705866899996181, 1.672046899999259, 1.706885699997656]
[0.8770668999932241, 0.6188776999988477, 0.761751699996239, 0.8418739999979152, 0.8385743999970146, 0.80280219999986, 0.7346493000004557, 0.8035249000022304, 0.7730817999981809, 0.926364899998589]
"""


"""4.1
[2.705229400002281, 2.6475705000048038, 2.303287699993234, 2.6470624999928987, 2.7040916999976616, 2.4741960000101244, 2.436163200007286, 2.6484991000033915, 2.602087700011907, 2.6189405000041006]
[8.919999527279288e-05, 1.2999953469261527e-06, 1.5999976312741637e-06, 0.00014050000754650682, 7.00005330145359e-07, 1.2999953469261527e-06, 0.00039829999150242656, 1.0999938240274787e-06, 0.00011789999553002417, 1.1999945854768157e-06]
"""


# orders 150000 * 10

"""1111111111111
mid-start:0.2978486000065459
end-mid:0.06650039998930879
mid-start:0.3434916999976849
end-mid:0.06219460000284016
mid-start:0.32221369999751914
end-mid:0.06637240000418387
mid-start:0.32750519999535754
end-mid:0.1627814999956172
mid-start:0.26375470000493806
end-mid:0.1389974999910919
mid-start:0.271604000008665
end-mid:0.10638250000192784
mid-start:0.28747110000404064
end-mid:0.12582210000255145
mid-start:0.26810390000173356
end-mid:0.14800660000764765
mid-start:0.2865484999929322
end-mid:0.15367900001001544
mid-start:0.2974432000046363
end-mid:0.16663429999607615
[0.2978486000065459, 0.3434916999976849, 0.32221369999751914, 0.32750519999535754, 0.26375470000493806, 0.271604000008665, 0.28747110000404064, 0.26810390000173356, 0.2865484999929322, 0.2974432000046363]
[0.06650039998930879, 0.06219460000284016, 0.06637240000418387, 0.1627814999956172, 0.1389974999910919, 0.10638250000192784, 0.12582210000255145, 0.14800660000764765, 0.15367900001001544, 0.16663429999607615]
"""


"""2222222222
mid-start:0.27043060000869446
end-mid:0.008551299993996508
mid-start:0.2624340000038501
end-mid:0.003099100009421818
mid-start:0.2898659000056796
end-mid:0.0030069999920669943
mid-start:0.27283319999696687
end-mid:0.0034472999977879226
mid-start:0.26777610000863206
end-mid:0.005724100003135391
mid-start:0.37494650000007823
end-mid:0.005537799996091053
mid-start:0.2901253999880282
end-mid:0.005128000004333444
mid-start:0.2621805999951903
end-mid:0.00525529999868013
mid-start:0.32230949999939185
end-mid:0.005229199989116751
mid-start:0.2716638999991119
end-mid:0.006354400000418536
[0.27043060000869446, 0.2624340000038501, 0.2898659000056796, 0.27283319999696687, 0.26777610000863206, 0.37494650000007823, 0.2901253999880282, 0.2621805999951903, 0.32230949999939185, 0.2716638999991119]
[0.008551299993996508, 0.003099100009421818, 0.0030069999920669943, 0.0034472999977879226, 0.005724100003135391, 0.005537799996091053, 0.005128000004333444, 0.00525529999868013, 0.005229199989116751, 0.006354400000418536]
"""

"""33333333333
mid-start:0.26739000000816304
end-mid:0.06725700000242796
mid-start:0.2877284999995027
end-mid:0.07014350000827108
mid-start:0.2795042999932775
end-mid:0.0692550000094343
mid-start:0.28986270001041703
end-mid:0.1689592999900924
mid-start:0.3309748000028776
end-mid:0.1433716000028653
mid-start:0.2715613000036683
end-mid:0.13842099999601487
mid-start:0.2997161999956006
end-mid:0.1407871000119485
mid-start:0.31232620000082534
end-mid:0.1693918999953894
mid-start:0.3301882999949157
end-mid:0.1567849999992177
mid-start:0.2977017999946838
end-mid:0.1397177000035299
[0.26739000000816304, 0.2877284999995027, 0.2795042999932775, 0.28986270001041703, 0.3309748000028776, 0.2715613000036683, 0.2997161999956006, 0.31232620000082534, 0.3301882999949157, 0.2977017999946838]
[0.06725700000242796, 0.07014350000827108, 0.0692550000094343, 0.1689592999900924, 0.1433716000028653, 0.13842099999601487, 0.1407871000119485, 0.1693918999953894, 0.1567849999992177, 0.1397177000035299]
"""



# partsupp
"""11111111111111111111
[80000 rows x 6 columns]
mid-start:0.12033390000578947
mid2:0.045876300006057136
end-mid:0.03895979998924304
[0.17445559999032412, 0.16905229999974836, 0.15448379999725148, 0.17484340000373777, 0.1639195000025211, 0.14084390000789426, 0.14003569999476895, 0.15333800000371411, 0.14057839999441057, 0.12033390000578947]
[0.09559799999988172, 0.07895650000136811, 0.08493409999937285, 0.05330070000491105, 0.0531217999960063, 0.06938240000454243, 0.09197980001044925, 0.04342100000940263, 0.04676870000548661, 0.045876300006057136]
[0.04870200000004843, 0.04790970000613015, 0.04627459999755956, 0.04845909999858122, 0.04209880001144484, 0.044662999993306585, 0.04319019999820739, 0.04081049999513198, 0.04687720000219997, 0.03895979998924304]
"""


# Region 5*4


"""
mid-start:0.0070071999944048
end-mid:0.005754500001785345
mid-start:0.009235400008037686
end-mid:0.0014126999885775149
mid-start:0.008672199997818097
end-mid:0.0015883000014582649
mid-start:0.0063738000026205555
end-mid:0.0015480000001844019
mid-start:0.00566570000955835
end-mid:0.0014841999945929274
mid-start:0.006166999999550171
end-mid:0.0013589000009233132
mid-start:0.005616100010229275
end-mid:0.0013360000011743978
mid-start:0.007135100007872097
end-mid:0.001406800001859665
mid-start:0.006908099996508099
end-mid:0.0013895000010961667
mid-start:0.007288000007974915
end-mid:0.0013344000035431236
[0.0070071999944048, 0.009235400008037686, 0.008672199997818097, 0.0063738000026205555, 0.00566570000955835, 0.006166999999550171, 0.005616100010229275, 0.007135100007872097, 0.006908099996508099, 0.007288000007974915]
[0.005754500001785345, 0.0014126999885775149, 0.0015883000014582649, 0.0015480000001844019, 0.0014841999945929274, 0.0013589000009233132, 0.0013360000011743978, 0.001406800001859665, 0.0013895000010961667, 0.0013344000035431236]
"""

"""11111111111111111
[0.009212999997544102, 0.009802899992791936, 0.010963799999444745, 0.01100620000215713, 0.018350900005316362, 0.013672000000951812, 0.010802100005093962, 0.009604799997759983, 0.008581700007198378, 0.0055542999907629564]
[0.01250689999142196, 0.004016700011561625, 0.0027815999928861856, 0.003224100000807084, 0.004329400006099604, 0.0021474999957717955, 0.0028297999961068854, 0.0039628000085940585, 0.0023877999919932336, 0.0015402999997604638]
[0.0016519000055268407, 0.0019066999957431108, 0.0012018999987049028, 0.0019346999906701967, 0.002066999993985519, 0.0009636000031605363, 0.0012406000023474917, 0.001883399992948398, 0.0011230999953113496, 0.0006752000044798478]
"""

"""2
mid-start:0.005956099994364195
end-mid:0.0059274000086588785
mid-start:0.005538600002182648
end-mid:0.0015565999929094687
mid-start:0.004747300001326948
end-mid:0.001301900003454648
mid-start:0.004316999998991378
end-mid:0.0014804000093135983
mid-start:0.004577900006552227
end-mid:0.0013411999971140176
mid-start:0.004854799990425818
end-mid:0.0012605000083567575
mid-start:0.00517670001136139
end-mid:0.001371199992718175
mid-start:0.004466800004593097
end-mid:0.001400699999067001
mid-start:0.007100999995600432
end-mid:0.0014253999979700893
mid-start:0.005346299993107095
end-mid:0.0013948999985586852
[0.005956099994364195, 0.005538600002182648, 0.004747300001326948, 0.004316999998991378, 0.004577900006552227, 0.004854799990425818, 0.00517670001136139, 0.004466800004593097, 0.007100999995600432, 0.005346299993107095]
[0.0059274000086588785, 0.0015565999929094687, 0.001301900003454648, 0.0014804000093135983, 0.0013411999971140176, 0.0012605000083567575, 0.001371199992718175, 0.001400699999067001, 0.0014253999979700893, 0.0013948999985586852]
"""

"""3
mid-start:0.007298799988348037
end-mid:0.006161400000564754
mid-start:0.007200199994258583
end-mid:0.0013642999983858317
mid-start:0.007538299993029796
end-mid:0.0014672000106656924
mid-start:0.006371200011926703
end-mid:0.0014528999890899286
mid-start:0.006510400009574369
end-mid:0.0013573999895015731
mid-start:0.005207800000789575
end-mid:0.0013999000075273216
mid-start:0.008288700002594851
end-mid:0.0013480000052368268
mid-start:0.0048790000000735745
end-mid:0.0013356999988900498
mid-start:0.00506709999172017
end-mid:0.0012953999976161867
mid-start:0.006344699999317527
end-mid:0.001471100011258386
[0.007298799988348037, 0.007200199994258583, 0.007538299993029796, 0.006371200011926703, 0.006510400009574369, 0.005207800000789575, 0.008288700002594851, 0.0048790000000735745, 0.00506709999172017, 0.006344699999317527]
[0.006161400000564754, 0.0013642999983858317, 0.0014672000106656924, 0.0014528999890899286, 0.0013573999895015731, 0.0013999000075273216, 0.0013480000052368268, 0.0013356999988900498, 0.0012953999976161867, 0.001471100011258386]
"""